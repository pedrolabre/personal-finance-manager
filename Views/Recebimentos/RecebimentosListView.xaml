
<UserControl x:Class="PersonalFinanceManager.Views.Recebimentos.RecebimentosListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="950">
    
    <UserControl.Resources>
        <!-- Estilo de linha para recebimentos -->
        <Style x:Key="RecebimentoRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding RecebimentoCompleto}" Value="True">
                    <Setter Property="Background" Value="#E8F5E9"/>
                    <Setter Property="Foreground" Value="#2E7D32"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Atrasado}" Value="True">
                    <Setter Property="Background" Value="#FFEBEE"/>
                    <Setter Property="Foreground" Value="#C62828"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- CabeÃ§alho -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Recebimentos" 
                      Style="{StaticResource TitleTextBlockStyle}"
                      VerticalAlignment="Center"/>
            
            <Button Content="âž• Novo Recebimento"
                   Command="{Binding NovoRecebimentoCommand}"
                   Style="{StaticResource PrimaryButtonStyle}"
                   HorizontalAlignment="Right"/>
        </Grid>
        
        <!-- Barra de Filtros -->
        <Border Grid.Row="1" 
               Style="{StaticResource CardStyle}"
               Margin="0,0,0,20"
               Padding="15">
            <Grid>
                <CheckBox IsChecked="{Binding MostrarApenasPendentes}"
                         Content="Mostrar apenas pendentes"
                         VerticalAlignment="Center"/>
                
                <Button Content="ðŸ”„ Atualizar"
                       Command="{Binding AtualizarCommand}"
                       Style="{StaticResource SecondaryButtonStyle}"
                       HorizontalAlignment="Right"/>
            </Grid>
        </Border>
        
        <!-- Lista de Recebimentos -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}">
            <DataGrid ItemsSource="{Binding Recebimentos}"
                     AutoGenerateColumns="False"
                     IsReadOnly="True"
                     SelectionMode="Single"
                     HeadersVisibility="Column"
                     GridLinesVisibility="None"
                     Background="Transparent"
                     BorderThickness="0"
                     RowHeight="70"
                     RowStyle="{StaticResource RecebimentoRowStyle}">
                
                <DataGrid.Columns>
                    <!-- Indicador de Status -->
                    <DataGridTemplateColumn Width="10">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="4" CornerRadius="2">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RecebimentoCompleto}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource SuccessColor}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Atrasado}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource DangerColor}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RecebimentoCompleto}" Value="False">
                                                    <Setter Property="Background" Value="{StaticResource WarningColor}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- DescriÃ§Ã£o e Categoria -->
                    <DataGridTemplateColumn Header="Recebimento" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Descricao}"
                                              FontWeight="SemiBold"
                                              FontSize="14"/>
                                    <TextBlock Text="{Binding Categoria}"
                                              FontSize="12"
                                              Foreground="{StaticResource TextSecondaryColor}"
                                              Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Data Prevista -->
                    <DataGridTextColumn Header="Data Prevista" 
                                       Binding="{Binding DataPrevista, StringFormat=dd/MM/yyyy}"
                                       Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Valor Esperado -->
                    <DataGridTextColumn Header="Valor Esperado" 
                                       Binding="{Binding ValorEsperado, StringFormat=C}"
                                       Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Valor Recebido -->
                    <DataGridTextColumn Header="Recebido" 
                                       Binding="{Binding ValorRecebido, StringFormat=C}"
                                       Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource SuccessColor}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Progresso -->
                    <DataGridTemplateColumn Header="Progresso" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel VerticalAlignment="Center">
                                    <ProgressBar Value="{Binding PercentualRecebido, Mode=OneWay}"
                                               Maximum="100"
                                               Height="8"
                                               Foreground="{StaticResource SuccessColor}"/>
                                    <TextBlock Text="{Binding PercentualRecebido, Mode=OneWay, StringFormat={}{0:F0}%}"
                                              FontSize="10"
                                              HorizontalAlignment="Center"
                                              Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Status -->
                    <DataGridTemplateColumn Header="Status" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="3" Padding="8,4" HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RecebimentoCompleto}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource SuccessColor}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Atrasado}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource DangerColor}"/>
                                                </DataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding RecebimentoCompleto}" Value="False"/>
                                                        <Condition Binding="{Binding Atrasado}" Value="False"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property="Background" Value="{StaticResource WarningColor}"/>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Foreground="White" FontSize="11" FontWeight="SemiBold">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RecebimentoCompleto}" Value="True">
                                                        <Setter Property="Text" Value="Completo"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Atrasado}" Value="True">
                                                        <Setter Property="Text" Value="Atrasado"/>
                                                    </DataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding RecebimentoCompleto}" Value="False"/>
                                                            <Condition Binding="{Binding Atrasado}" Value="False"/>
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter Property="Text" Value="Pendente"/>
                                                    </MultiDataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- AÃ§Ãµes -->
                    <DataGridTemplateColumn Header="AÃ§Ãµes" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" 
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center">
                                    <Button Content="âœï¸"
                                           Command="{Binding DataContext.EditarCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                           CommandParameter="{Binding Id}"
                                           ToolTip="Editar"
                                           Width="26"
                                           Height="26"
                                           Margin="1"
                                           FontSize="11"
                                           Style="{StaticResource SecondaryButtonStyle}"/>
                                    
                                    <Button Content="âœ“"
                                           Command="{Binding DataContext.RegistrarRecebimentoCompletoCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                           CommandParameter="{Binding Id}"
                                           ToolTip="Marcar como Recebido"
                                           Width="26"
                                           Height="26"
                                           Margin="1"
                                           FontSize="11"
                                           Style="{StaticResource SuccessButtonStyle}"
                                           Visibility="{Binding RecebimentoCompleto, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                    
                                    <Button Content="Â½"
                                           Command="{Binding DataContext.RegistrarRecebimentoParcialCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                           CommandParameter="{Binding Id}"
                                           ToolTip="Registrar Parcial"
                                           Width="26"
                                           Height="26"
                                           Margin="1"
                                           FontSize="11"
                                           Style="{StaticResource SecondaryButtonStyle}"
                                           Visibility="{Binding RecebimentoCompleto, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                    
                                    <Button Content="ðŸ—‘ï¸"
                                           Command="{Binding DataContext.ExcluirCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                           CommandParameter="{Binding Id}"
                                           ToolTip="Excluir"
                                           Width="26"
                                           Height="26"
                                           Margin="1"
                                           FontSize="11"
                                           Style="{StaticResource DangerButtonStyle}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
        
        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
               Background="#80000000"
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="Carregando..."
                      Foreground="White"
                      FontSize="20"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
        </Border>
    </Grid>
</UserControl>
